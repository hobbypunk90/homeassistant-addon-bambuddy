#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the example service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Add your code here
declare debug
debug=$(bashio::config 'debug')

bashio::log.info 'Link data dir'
mkdir -p /data/data
mkdir -p /data/logs
rm -r /app/data
rm -r /app/logs
ln -s /data/data /app/data
ln -s /data/logs /app/logs

cd /app

if [ "${debug}" = "true" ]; then
  bashio::log.info 'Enabling debug mode'
  export DEBUG=true
fi

bashio::log.info 'Start Bambuddy ...'
uvicorn backend.app.main:app --host 0.0.0.0 --port 8000 --loop asyncio
